<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
        <link href="inputs.css" rel="stylesheet">
	</head>
	<body>
        <div class="login-page">
  <div class="form">
    <form class="login-form">
      <input type="text" id="login" placeholder="Имя пользователя"/>
      <input type="password" id="password" placeholder="Пароль"/>
      <button type="button" onclick="loginButtonHandler()">войти</button>
      <p>
      <button type="button" onclick="regButtonHandler()">зарегистрироваться</button>
</p>
<p id="output"></p>
    </form>
  </div>
</div>

    <p id="output"></p>

    <script src="security.js"></script>
        <script>
            function loginButtonHandler() {
                var x = document.getElementById("login").value;
                var y = document.getElementById("password").value;
                sendSignInRequest(x, y);
            }

            function regButtonHandler() {
                var x = document.getElementById("login").value;
                var y = document.getElementById("password").value;
                sendSignUpRequest(x, y);
            }

            function sendSignUpRequest(login, password){
                var request = JSON.stringify(
                {
                    type: "sign_up",
                    data: {
                        login:login,
                        password:password
                    }
                } );

                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/api/v1/signup', true);
                xhr.setRequestHeader('Content-Type', 'application/json');

                xhr.onreadystatechange = function(){
                    if (this.readyState != 4)
                        return;

                    if (this.status != 200)
                    {
                        document.getElementById("output").innerHTML = this.status + ':' + this.statusText;
                    }
                    else
                    {
                        document.getElementById("output").innerHTML = this.responseText;
                    }
                }

                xhr.send(request);
            }

            function sendSignInRequest(login, password){
                var request = JSON.stringify(
                {
                    type: "sign_in",
                    data: {
                        login:login,
                        password:password
                    }
                } );

                var xhr = new XMLHttpRequest();
                xhr.open('POST', 'api/v1/signin', true);
                xhr.setRequestHeader('Content-Type', 'application/json');

                xhr.onreadystatechange = function(){
                    if (this.readyState != 4)
                        return;

                    if (this.status != 200)
                    {
                        document.getElementById("output").innerHTML = this.status + ':' + this.statusText;
                    } else {
                        document.getElementById("output").innerHTML = this.responseText;
                        var response = JSON.parse(this.responseText);
                        if (response.status === 'success'){
                            saveSidToCookie(response.sid);
                            document.location.href = "/index.html";
                    }
                    }
                };

                xhr.send(request);
            }
		</script>

	</body>
</html>
